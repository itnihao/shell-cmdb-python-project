# -*- coding: utf-8 -*-from application import dbfrom models.user import Userfrom models.pool import Poolfrom models.pool_host import PoolHostfrom models.host import Hostimport hashlibclass Poolinit:    def run(self):        db.engine.execute("truncate table pool")        db.engine.execute("truncate table pool_host")        self.initpool()        self.addpool()    def addpool(self):        pools=self.poollist        for item in pools:            cn_names=[item['bo'],item['to'],item['oo']]            userinfo=User.query.filter(User.cn_name.in_(cn_names)).all()            userlist={}            if userinfo:                for tmpuser in userinfo:                    userlist['cn_name_%s'%hashlib.md5(tmpuser.cn_name).hexdigest()]=tmpuser.id            ops_owner_id=userlist['cn_name_%s'%hashlib.md5(item['oo']).hexdigest()]            team_owner_id=userlist['cn_name_%s'%hashlib.md5(item['bo']).hexdigest()]            biz_owner_id=userlist['cn_name_%s'%hashlib.md5(item['to']).hexdigest()]            pooltarget=Pool(item['name'],ops_owner_id,team_owner_id,biz_owner_id,content=item['name'])            db.session.add(pooltarget)            db.session.commit()            pool_id=pooltarget.id            if pool_id:                for hostname in item['items']:                    tmphosttarget=Host.query.filter(Host.hostname==hostname).first()                    if tmphosttarget.id:                        poolhosttarget=PoolHost(pool_id,tmphosttarget.id)                        db.session.add(poolhosttarget)                        db.session.commit()                        tmphosttarget.status=Host.STATUS_ASSIGNED                        db.session.commit()    def initpool(self):        pools=[]        item={            "name":"经纪人web",            "bo":"卢现升",            "to":"卢现升",            "oo":"郭威",            "items":[                "app10-034",                "app10-035",                "app10-036",                "app10-083",                "app10-133",                "app10-163"            ]        }        pools.append(item)        item={            "name":"经纪人job",            "bo":"卢现升",            "to":"卢现升",            "oo":"郭威",            "items":[                "app10-081"            ]        }        pools.append(item)        item={            "name":"经纪人cms",            "bo":"卢现升",            "to":"卢现升",            "oo":"郭威",            "items":[                "xapp10-031",                "xapp10-032"            ]        }        pools.append(item)        item={            "name":"网络门店",            "bo":"卢现升",            "to":"陈绪",            "oo":"郭威",            "items":[                "app10-092",                "app10-139",                "app10-135"            ]        }        pools.append(item)        item={            "name":"房东业务个人发房",            "bo":"安红亮",            "to":"吴雄杰",            "oo":"郭威",            "items":[                "xapp10-031",                "xapp10-032"            ]        }        pools.append(item)        item={            "name":"用户行为分析",            "bo":"卢现升",            "to":"卢现升",            "oo":"郭威",            "items":[                "app10-062"            ]        }        pools.append(item)        item={            "name":"经纪人java-api",            "bo":"朱拱平",            "to":"朱拱平",            "oo":"郭威",            "items":[                "app10-043",                "app10-142",                "app10-180"            ]        }        pools.append(item)        item={            "name":"经纪人java-openapi",            "bo":"朱拱平",            "to":"朱拱平",            "oo":"郭威",            "items":[                "app10-032",                "xapp10-006"            ]        }        pools.append(item)        item={            "name":"经纪人java-exp-api",            "bo":"朱拱平",            "to":"朱拱平",            "oo":"郭威",            "items":[                "app10-093",                "app10-094",                "app10-054"            ]        }        pools.append(item)        item={            "name":"SOJ",            "bo":"朱拱平",            "to":"朱拱平",            "oo":"郭威",            "items":[                "app10-108",                "app10-084",                "app10-068",                "one-667",                "app10-109",                "app10-086"            ]        }        pools.append(item)        item={            "name":"经纪人crm-web",            "bo":"洪鑫锋",            "to":"洪鑫锋",            "oo":"郭威",            "items":[                "xapp10-005",                "xapp10-017",                "xapp10-078",                "app10-001"            ]        }        pools.append(item)        item={            "name":"经纪人crm-job",            "bo":"洪鑫锋",            "to":"洪鑫锋",            "oo":"郭威",            "items":[                "xapp10-005",                "app10-007",                "app10-086"            ]        }        pools.append(item)        item={            "name":"校招",            "bo":"洪鑫锋",            "to":"洪鑫锋",            "oo":"郭威",            "items":[                "app10-196",                "app10-197"            ]        }        pools.append(item)        item={            "name":"微信客服",            "bo":"洪鑫锋",            "to":"洪鑫锋",            "oo":"郭威",            "items":[                "xapp10-063"            ]        }        pools.append(item)        item={            "name":"支付中心",            "bo":"卢现升",            "to":"王全才",            "oo":"郭威",            "items":[                "app10-066",                "app10-072"            ]        }        pools.append(item)        item={            "name":"新房web",            "bo":"杨勇",            "to":"李松",            "oo":"郭威",            "items":[                "app10-018",                "app10-019",                "app10-020",                "app10-183",                "app10-130",                "app10-145"            ]        }        pools.append(item)        item={            "name":"新房jobs",            "bo":"杨勇",            "to":"李松",            "oo":"郭威",            "items":[                "app10-022",                "app10-185"            ]        }        pools.append(item)        item={            "name":"新房bouchweb",            "bo":"杨勇",            "to":"李松",            "oo":"郭威",            "items":[                "app10-018",                "app10-019",                "app10-020",                "app10-183",                "app10-130",                "app10-145"            ]        }        pools.append(item)        item={            "name":"新房crm",            "bo":"杨勇",            "to":"李松",            "oo":"郭威",            "items":[                "app10-183"            ]        }        pools.append(item)        item={            "name":"新房java-api",            "bo":"杨勇",            "to":"李松",            "oo":"郭威",            "items":[                "app10-120",                "app10-121"            ]        }        pools.append(item)        item={            "name":"solr",            "bo":"吴志山",            "to":"周乐钦",            "oo":"郭威",            "items":[                "app10-121",                "app10-132",                "app10-143",                "idx10-014",                "idx10-015",                "idx10-016",                "idx10-017",                "idx10-018"            ]        }        pools.append(item)        item={            "name":"solr-web",            "bo":"吴志山",            "to":"周乐钦",            "oo":"郭威",            "items":[                "app10-131"            ]        }        pools.append(item)        item={            "name":"varnish",            "bo":"郭威",            "to":"夏明然",            "oo":"郭威",            "items":[                "app10-041",                "app10-030",                "app10-038",                "app10-064"            ]        }        pools.append(item)        item={            "name":"AFS_squid",            "bo":"董炜",            "to":"董炜",            "oo":"郭威",            "items":[                "cdn20-001",                "cdn20-002",                "cdn20-003",                "cdn20-004",                "cdn20-005",                "cdn20-011",                "cdn20-012",                "cdn20-013",                "cdn20-014",                "cdn20-015"            ]        }        pools.append(item)        item={            "name":"AFS_app",            "bo":"董炜",            "to":"董炜",            "oo":"郭威",            "items":[                "aia20-001",                "aia20-002",                "aia20-004",                "aia20-005",                "aia20-006",                "aia20-007",                "aia20-008",                "aia20-009",                "aia20-010"            ]        }        pools.append(item)        item={            "name":"AFS_tracker",            "bo":"董炜",            "to":"董炜",            "oo":"郭威",            "items":[                "trk20-001",                "trk20-002",                "trk20-003",                "trk20-004"            ]        }        pools.append(item)        item={            "name":"AFS_存储",            "bo":"董炜",            "to":"董炜",            "oo":"郭威",            "items":[                "IMG20-001",                "img20-002",                "img20-005",                "img20-006",                "img20-007",                "img20-008",                "img20-009",                "img20-010",                "img20-011",                "img20-013",                "img20-015",                "img20-016",                "img20-017",                "img20-018",                "img20-019",                "img20-020",                "img20-021",                "img20-022",                "img20-023",                "img20-024",                "img20-025",                "img20-026"            ]        }        pools.append(item)        item={            "name":"DB",            "bo":"周枫",            "to":"兰春",            "oo":"郭威",            "items":[                "db10-001",                "db10-003",                "db10-005",                "db10-006",                "db10-007",                "db10-008",                "db10-009",                "db10-010",                "db10-011",                "db10-012",                "db10-013",                "db10-015",                "db10-016",                "db10-017",                "db10-018",                "db10-019",                "db10-020",                "db10-021",                "db10-022",                "db10-023",                "db10-024",                "db10-025",                "db10-026",                "db10-027",                "db10-028",                "db10-029",                "db10-030",                "db10-033",                "db10-035",                "db10-036",                "db10-037",                "db10-038",                "db10-039",                "db10-040",                "db10-046",                "db10-047",                "db10-048",                "db10-049",                "db10-054",                "db10-055",                "db10-056",                "db10-057",                "db10-058",                "db10-059",                "db10-060",                "db10-061",                "db10-062",                "db10-065",                "db10-066",                "db10-067",                "db10-068",                "db10-069",                "db10-070",                "db10-071",                "db10-072",                "db10-073",                "db10-074",                "db10-075",                "db10-076",                "db10-077",                "db10-078",                "db10-079",                "db10-080",                "db10-150",                "db10-151",                "db10-152",                "db10-153",                "db20-005",                "db20-006",                "db20-007",                "db20-008",                "db20-009",                "db20-010",                "db20-012",                "db20-013",                "db20-014",                "db20-016",                "db20-017",                "db20-018",                "db20-020",                "db20-021",                "db20-022",                "db20-023",                "db20-024",                "db20-025",                "db20-026",                "db20-030",                "db20-031",                "db20-032",                "db20-033",                "db20-034",                "db20-035",                "db20-036",                "db20-037",                "db20-038",                "db20-039",                "db20-040",                "db20-041",                "db20-042",                "db20-043",                "db20-044",                "db20-045",                "db20-046",                "db20-047",                "db20-048",                "db20-049",                "db20-050",                "db20-051",                "db20-052",                "db20-053",                "db20-054",                "db20-055",                "db20-056",                "db20-057",                "db20-058",                "db20-059",                "dbbak10-001",                "dbbak10-002",                "dbbak10-003",                "dbbak10-004",            ]        }        pools.append(item)        self.poollist=pools