;var cmdb_ops = {    init:function(){        $("#juhesearch").val("");        this.searchSize = 5;        this._moveidx = -1;        this._enterurl = "";        this.msg();        this.nav_highlight();    },    eventBind:function(){        var that = this;        $("#juhesearch").keyup(function(event){            keycode = event.keyCode;            if(keycode == 27 || keycode == 33 || keycode ==34 || keycode == 38 || keycode ==40 ){                return false;            }            if(keycode == 13){                that.jump();            }            that.suggest_search();        });        $("#juhesearch").blur(function(){            that.suggest_hide();        });        $("#juhesearch").keydown(function(event){            switch ( event.keyCode ) {                case 13://enter                    that.jump();                    break;                case 27://esc                    that.suggest_hide();                    break;                case 33://page up                    that._move(event,"prex");                    break;                case 34://page down                    that._move(event,"next");                    break;                case 38://up                    that._move(event,"prex");                    break;                case 40://down                    that._move(event,"next");                    break;            }        });        $("#myapproval").click(function(){            $("span[name=msg]").css({                'display': none            });        });    },    format_items:function(content,type,q){        var items = content.data;        var leng = items.length;        var size = content.size;        var url = content.url;        var body = "";        var type_desc = "";        if(type == 1){            type_desc = "设备";        }else if (type ==2){            type_desc = "主机";        }else if (type ==3){            type_desc = "POOL";        }        if(size > cmdb_ops.searchSize){             body += '<li class="ui-menu-item suggest nopadding">';             body += q+"在<a href='" + url + "'>"+type_desc+"列表</a>搜索";             body += '</li>'        }else if(size>0 && size<= cmdb_ops.searchSize){             body += '<li class="ui-menu-item suggest" style="padding-left: 5px !important;"><a href="' + url + '">' + type_desc + '列表</a>';             for(var k=0;k<leng;k++){                    body += '<li class="ui-menu-item suggest"><a href=' + items[k][1] + '>' + items[k][0] + '</a></li>';             }            body += '</li>';        }else{            return ''        }        return body;    },    suggest_show:function(){         var that = this;         var target = $("#juhesearch");         var top = target.offset().top + 30;         var left = target.offset().left - 16;         $("#search_ul").css({            'top': (top) ? top : 'auto',            'bottom': 'auto',            'left': (left) ? left : 'auto',            'right': 'auto'         });        $("#search_ul").css('visibility', 'visible').show();        $(".suggest").mousedown(function(event){            that._enterurl = $(this).attr("href");            that.jump();            return false;        });    },    suggest_hide:function(){        $("#search_ul").css('visibility', 'hidden').hide();    },    suggest_search:function(){        var that = this;        that._moveidx = -1;        that._enterurl = "";        var q = $("#juhesearch").val();        if(q.length <= 0) {            that.suggest_hide();            return false;        }        $.ajax({            'url': '/cmdb/pmz_search/',            'type': 'post',            'dataType': 'json',            'data': {'q': q,'size':that.searchSize},            success: function (res) {                $("#search_ul").html("");                device = res.data.device;                host = res.data.host;                pool = res.data.pool;                if(device.size==0 && host.size==0 && pool.size==0){                    $("#search_ul").css('visibility', 'hidden').hide();                        return false;                }                device_html = that.format_items(device,1,q);                host_html = that.format_items(host,2,q);                pool_html = that.format_items(pool,3,q);                $("#search_ul").html(device_html+host_html+pool_html);                that.suggest_show();            }        });    },    _move:function(evt,type){        var idx = this._moveidx;        var suggest_length = $(".suggest").length-1;        if(idx>= 0 && idx<=suggest_length){            $($(".suggest").get(idx)).css("background-color","white");        }        if(type == "next"){            current_idx = idx+1 ;            if(current_idx > suggest_length){                current_idx = 0;            }        }else{            current_idx = idx-1 ;            if(current_idx<0){                current_idx = suggest_length;            }        }        var target = $($(".suggest").get(current_idx));        target.css("background-color","#e0e0e0");        var key_q = target.find("a").text();        $("#juhesearch").val(key_q);        this._enterurl = target.find("a").attr("href");        this._moveidx = current_idx;        return false;    },    jump:function(){        if(this._enterurl){            window.location.href  = this._enterurl;        }    },    msg:function() {        $.ajax({            'url': '/user/msg',            'type': 'post',            'dataType': 'json',            success: function (res) {                data = res.data;                host_count = parseInt(data.host);                bastion_count = parseInt(data.bastion);                ticket_count = parseInt(data.ticket_count);                num = host_count+bastion_count;                if(num){                    if(bastion_count>0){                        $("#popmsg").attr("href","/user/papproval");                    }else if(host_count>0){                        $("#popmsg").attr("href","/user/happroval");                    }                    $("span[name=msg]").removeAttr("style");                    $("span[name=msg]").html(num);                }                if(ticket_count>0){                    $("span[name=sa_msg]").removeAttr("style");                    $("span[name=sa_msg]").html(ticket_count);                }            }        })    },    nav_highlight:function(){        var path = location.pathname;        if((/monitor/).test(path)){            $("#tabmonitor").addClass("active");            return false;        }        if((/logger/).test(path)){            $("#tabLogger").addClass("active");            return false;        }        if((/sa\/tickets\/add/).test(path)){            $("#tabcmdb").addClass("active");            return false;        }        if((/sa\/tickets\/[add|mod|\d{1,}]/).test(path)){            $("#tabcmdb").addClass("active");            return false;        }        if((/sa/).test(path)){            $("#tabsa").addClass("active");            return false;        }        $("#tabcmdb").addClass("active");    }};function sortable(element){	$(element).footable();    $('.sort-column').click(function (e) {        e.preventDefault();        var footableSort = $(element).data('footable-sort');        var index = $(this).data('index');        footableSort.doSort(index, 'toggle');    });}$(document).ready(function(){    cmdb_ops.init();    cmdb_ops.eventBind();});