;var poolops = {    bingevents: function () {        var that=this;        $("#addpool").click(function () {            $($("#pooldiv h3").get(0)).html("添加pool");            that.msgtips("");            $("#name").val("");            $("#byname").val("");            $("#ops_owner").val("");            $("#ops_owner_id").val("");            $("#team_owner").val("");            $("#team_owner_id").val("");            $("#biz_owner").val("");            $("#biz_owner_id").val("");            $("#source").val("0");            $("#content").val("");            $("#note").val("");            $("#primaryid").val("");            $("#pooldiv").foundation('reveal', 'open');        });        $("#doadd").click(function () {            var name = $.trim($("#name").val());            var byname = $.trim($("#byname").val());            var ops_owner = $.trim($("#ops_owner").val());            var ops_owner_id = $.trim($("#ops_owner_id").val());            var biz_owner = $.trim($("#biz_owner").val());            var biz_owner_id = $.trim($("#biz_owner_id").val());            var team_owner = $.trim($("#team_owner").val());            var team_owner_id = $.trim($("#team_owner_id").val());            var primaryid= $.trim($("#primaryid").val());            var source = $.trim($("#source").val());            var content = $.trim($("#content").val());            var note = $.trim($("#note").val());            var dc_id = $.trim($("#dp_id").val());            if (name.length <= 0) {                that.msgtips("请输入pool名称", 0);                return false;            }            if (ops_owner.length <= 0 || ops_owner_id.length <= 0) {                that.msgtips("请输入ops负责人", 0);                return false;            }            if (team_owner.length <= 0 || team_owner_id.length <= 0) {                that.msgtips("请输入pool负责人", 0);                return false;            }            if (biz_owner.length <= 0 || biz_owner_id.length <= 0) {                that.msgtips("请输入业务负责人", 0);                return false;            }            if (content.length <= 0) {                that.msgtips("请输入pool描述", 0);                return false;            }            if (dc_id.length <= 0 || dc_id == '1000'|| dc_id ==1000) {                that.msgtips("请选择所属部门", 0);                return false;            }            var data = {'name': name, 'ops_owner': ops_owner, 'ops_owner_id': ops_owner_id, 'biz_owner': biz_owner,'department_id':dc_id,                'biz_owner_id': biz_owner_id, 'team_owner': team_owner, 'team_owner_id': team_owner_id, 'note': note, 'content': content};            data.byname = byname;            data.source = source;            if (primaryid && /^[1-9]\d*$/.test(primaryid)) {                $.ajax({                    'url': '/cmdb/pool/modify/' + primaryid,                    'type': 'post',                    'dataType': 'json',                    'data': data,                    success: function (res) {                        if (res.code == 1) {                            that.msgtips(res.msg, 0);                        } else {                            that.msgtips(res.msg, 1);                            $("#pooldiv").foundation('reveal', 'close');                            window.location.href = window.location.href;                        }                    }                })            }else{                $.ajax({                    'url': '/cmdb/pool/add',                    'type': 'post',                    'dataType': 'json',                    'data': data,                    success: function (res) {                        if (res.code == 1) {                            that.msgtips(res.msg, 0);                        } else {                            that.msgtips(res.msg, 1);                            $("#pooldiv").foundation('reveal', 'close');                            window.location.href = window.location.href;                        }                    }                })            }        });        $(".cs_pooledit").each(function(){           $(this).click(function(){                that.editpool($(this).attr("id").replace("pool_edit_",""));                return false;           }) ;        });        $(".cs_pooldel").each(function(){           $(this).click(function(){                that.deletepool($(this).attr("id").replace("pool_del_",""));                return false;           }) ;        });    },    autofix: function () {        options = {            source: function (request, response) {                $.ajax({                    url: "/user/search",                    type: 'POST',                    dataType: "json",                    data: {                        maxRows: 12,                        keyword: request.term                    },                    success: function (data) {                        response($.map(data, function (item) {                            return {                                label: item[1],                                value: item[0]                            }                        }));                    }                });            },            minChars: 1,            max: 5,            scroll: true,            autoFill: true,            mustMatch: true,            matchContains: false,            scrollHeight: 50,            select: function (event, ui) {                if ($(this).attr("id") == "ops_owner") {                    $("#ops_owner").val(ui.item.label);                    $("#ops_owner_id").val(ui.item.value);                } else if ($(this).attr("id") == "team_owner") {                    $("#team_owner").val(ui.item.label);                    $("#team_owner_id").val(ui.item.value);                } else if ($(this).attr("id") == "biz_owner") {                    $("#biz_owner").val(ui.item.label);                    $("#biz_owner_id").val(ui.item.value);                }                return false;            }        };        //添加autocomplete        $("#ops_owner").autocomplete(options);        $("#team_owner").autocomplete(options);        $("#biz_owner").autocomplete(options);    },    msgtips: function (msg, type) {        if (msg) {            if (type == 0) {                $("#msgtips").removeClass("success");                $("#msgtips").addClass("alert");            } else if (type == 1) {                $("#msgtips").removeClass("alert");                $("#msgtips").addClass("success");            }            $("#msgtips").html(msg);            $("#msgtips").show();        } else {            $("#msgtips").hide();        }    },    deletepool:function(id){       if(confirm("操作提示:\r\n删除pool将会删除pool下所有的主机关联,不可恢复")){           if(!/^[1-9]\d*$/.test(id)){               return false;           }           $.ajax({                url: "/cmdb/pool/delete/"+id,                type: 'POST',                dataType: "json",                success: function (res) {                    if (res.code == 1) {                        alert(res.msg);                        return;                    }                    window.location.href = window.location.href;                }           })       }    },    editpool:function(id){       if(!/^[1-9]\d*$/.test(id)){               return false;       }       $.ajax({                url: "/cmdb/pool/"+id,                type: 'POST',                dataType: "json",                success: function (res) {                    if(!res){                        return;                    }                    $($("#pooldiv h3").get(0)).html("编辑pool");                    poolops.msgtips("");                    $("#name").val(res.name);                    $("#byname").val(res.byname);                    $("#ops_owner").val(res.ops_owner);                    $("#ops_owner_id").val(res.ops_owner_id);                    $("#team_owner").val(res.team_owner);                    $("#team_owner_id").val(res.team_owner_id);                    $("#biz_owner").val(res.biz_owner);                    $("#biz_owner_id").val(res.biz_owner_id);                    $("#source").val(res.source);                    $("#content").val(res.content);                    $("#note").val(res.note);                    $("#primaryid").val(res.id);                    $("#dp_id").val(res.department_id);                    $("#pooldiv").foundation('reveal', 'open');                }       })    },    tooltips:function(){        $(document).foundation();        $(".tooltip-display").each(function(){          $(this).mouseleave(function(){                $(".tooltip-display-wrap").css('visibility', 'hidden').hide();          });          $(this).mouseenter(function(){               var target = $(this);               var top = target.offset().top +26;               var left = target.offset().left;               var content = target.attr("data");               $(".tooltip-display-wrap .content").html(content);               $(".tooltip-display-wrap").css('visibility', 'visible').show();               $(".tooltip-display-wrap").css({                    'top' : (top) ? top : 'auto',                    'bottom' : 'auto',                    'left' : (left) ? left : 'auto',                    'right' : 'auto'               });          });        });    },    poolloads:function(){        var poolids  = new Array();        $(".poolload").each(function(){            var classname = $(this).attr("class");            var pool_id = classname.replace("poolload poolload_","");            pool_id = parseInt(pool_id);            if(pool_id>0){                poolids.push(pool_id);            }        });        if(poolids.length<=0){            return false;        }        $.ajax({                url: "/cmdb/pool/ratio",                type: 'POST',                data:{'ids':poolids.join(",")},                dataType: "json",                success: function (res) {                    if(!res){                        return;                    }                    ratios =res.data[0];                    for(var key in ratios){                        classname = key;                        content ='<span class="shine_circle" style="color: '+ratios[key][2]+';">●</span>'+                        '<a data-type="numeric" data-value="'+ratios[key][0]+'" href="" class="tooltip-display" data="采集时间:'+ratios[key][1]+'">'+ratios[key][0]+'%</a>'                        $("."+classname).html(content);                    }                    poolops.tooltips();                    sortable('table');                }            }        )    }}$(document).ready(function () {    poolops.bingevents();    poolops.autofix();    poolops.poolloads();    //dep=getCookie("dep")    //if(dep){    //    if(cu_dep!=dep) {    //        var url = flask_util.url_for('pool.search_dp', {dp_id: dep})    //        window.location.href = url;    //    //    }    $("#dp_id_2").val(cu_dep)    $("#dp_id_2").change(function () {        pool_value = $.trim($("#dp_id_2").val());        setCookie('dep',pool_value)        var url=flask_util.url_for('pool.index')         window.location.href = url;    });    function setCookie(name, value) {       var argv = setCookie.arguments;       var argc = setCookie.arguments.length;       var expires = (argc > 2) ? argv[2] : null;       if(expires!=null)       {           var LargeExpDate = new Date ();           LargeExpDate.setTime(LargeExpDate.getTime() + (expires*1000*3600*24));       }       document.cookie = name + "=" + escape (value)+((expires == null) ? "" : ("; expires=" +LargeExpDate.toGMTString()));    }    function getCookie(Name) {       var search = Name + "="       if(document.cookie.length > 0)       {           offset = document.cookie.indexOf(search)           if(offset != -1)           {               offset += search.length               end = document.cookie.indexOf(";", offset)               if(end == -1) end = document.cookie.length               return unescape(document.cookie.substring(offset, end))           }           else return ""       }    }    function deleteCookie(name) {        var expdate = new Date();        expdate.setTime(expdate.getTime() - (86400 * 1000 * 1));       setCookie(name, "", expdate);    }});