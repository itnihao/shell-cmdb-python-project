{%extends base%}
{% block extra_head %}
    <!-- page specific plugin scripts -->
    <link rel="stylesheet" href="{{ STATIC_URL }}css/dropzone.min.css"/>
    <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery-ui.custom.min.css"/>
    <script src="{{ STATIC_URL }}js/jquery.dataTables.min.js"></script>
    <script src="{{ STATIC_URL }}js/jquery.dataTables.bootstrap.min.js"></script>
    <script src="{{ STATIC_URL }}js/dataTables.tableTools.min.js"></script>
    <script src="{{ STATIC_URL }}js/dataTables.colVis.min.js"></script>
    <script src="{{ STATIC_URL }}js/dropzone.min.js"></script>
    <script src="{{ STATIC_URL }}js/tables.js"></script>
    <script src="{{ STATIC_URL }}js/bootbox.min.js"></script>
    <script src="{{ STATIC_URL }}plugin/sweetalert/sweet-alert.min.js"></script>
    <link rel="stylesheet" href="{{ STATIC_URL }}plugin/sweetalert/sweet-alert.css"/>

{% endblock %}

{% block Hometitle %}<a href="{% url 'home' %}"> 基础资源管理 </a>{% endblock %}
{% block actiontitle %} <a href="{% url 'server.index' %}"> 服务器资源管理 </a> {% endblock %}

{% block pagetitle %} <a href="{% url 'server.index' %}"> 服务器管理 </a>{% endblock %}

{% block pagecontent %}

    <div class="main-container" id="main-container">

        <div class="page-content">

            <div class="widget-box">
                <div class="table-header">
                    查询条件
                </div>
                <div class="widget-header">

                    <!--  <div class="widget-toolbar">
                        <a data-action="collapse" href="#">
                          <i id="arrow" class="ace-icon fa fa-chevron-up"></i>
                        </a>

                        <a data-action="close" href="#">
                          <i class="ace-icon fa fa-times"></i>
                        </a>
                      </div>  -->
                </div>

                <!-- 查询条件 start -->
                <div class="widget-body">
                    <div class="widget-main">
                        <div class="row">
                            <div class="col-sm-4">
                                <div class="row row-in">
                                    <label for="Inputinip" class="col-sm-3 lable-tip">内网IP:</label>
                                    <textarea class="search-area col-sm-8" id="inip"
                                              placeholder="内网IP;多行用,隔开"></textarea>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="row row-in">
                                    <label for="Iputoutip" class="col-sm-3 lable-tip">外网IP:</label>
                                    <textarea class="search-area col-sm-8" id="outip"
                                              placeholder="外网IP;多行用,隔开"></textarea>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="row row-in">
                                    <label for="Inputbmcip" class="col-sm-3 lable-tip">管理卡IP:</label>
                                    <textarea class="search-area col-sm-8" id="bmcip"
                                              placeholder="管理卡IP;多行用,隔开"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="widget-main">
                        <div class="row">
                            <div class="col-sm-4">
                                <div class="row row-in">
                                    <label for="incservertype" class="col-sm-3 lable-tip">机器类型:</label>
                                    <select class="col-sm-8 select-com" id="incservertype" name="incservertype">
                                        <option value="">请选择</option>
                                        {% for type in incservertype %}
                                            <option value="{{ type.inc_server_type_name }}">{{ type.inc_server_type_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="row row-in">
                                    <label for="servertype" class="col-sm-3 lable-tip">设备类型:</label>
                                    <select class="col-sm-8 select-com" id="servertype" name="servertype">
                                        <option value="">请选择</option>
                                        {% for type,value in servertype.items %}
                                            <option value="{{ value }}">{{ type }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="row row-in">
                                    <label for="incservertype" class="col-sm-3 lable-tip">品牌:</label>
                                    <select class="col-sm-8 select-com" id="servermodel" name="servermodel">
                                        <option value="">请选择</option>
                                        {% for model in servermodel %}
                                            <option value="{{ model.producer_name }}">{{ model.producer_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="widget-main">
                        <div class="row">
                            <div class="col-sm-4">
                                <div class="row row-in">
                                    <label for="InputAccessno" class="col-sm-3 lable-tip">资产编号:</label>
                                    <textarea class="search-area col-sm-8" id="accessno"
                                              placeholder="资产编号;多行用,隔开"></textarea>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="row row-in">
                                    <label for="InputAccesssn" class="col-sm-3 lable-tip">SN号:</label>
                                    <textarea class="search-area col-sm-8" id="accesssn"
                                              placeholder="SN号;多行用,隔开"></textarea>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="row row-in">
                                    <label for="InputCluster" class="col-sm-3 lable-tip">集群名称:</label>
                                    <textarea class="search-area col-sm-8" id="cluster" placeholder="支持模糊查询"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="widget-toolbox padding-4 clearfix">
                        <div class="col-md-12 align-c">
                            <button class="btn btn-sm btn-success btn-white btn-round" onclick=ServerSearch()
                                    type="button">
                                <i class="ace-icon fa fa-check bigger-110"></i>
                                查询
                            </button>
                            &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;
                            <button class="btn btn-sm btn-danger btn-white btn-round" onclick=ServerReset()
                                    type="reset">
                                <i class="ace-icon fa fa-undo bigger-110"></i>
                                重置
                            </button>
                        </div>
                    </div>
                </div>
                <!-- 查询条件 start -->
            </div>


            <!-- 服务器资源列表 start -->
            <div class="table-header">
                服务器资源详细信息
            </div>
            <div class="table-wrap">
                <table id="dynamic-table" class="table table-striped table-bordered table-hover table-list-service">
                    <thead>
                    <tr>
                        <th width="30">
                            <label class="pos-rel">
                                <input type="checkbox" class="ace">
                                <span class="lbl"></span>
                            </label>
                        </th>
                        <th width="90" nowrap="nowrap">SN</th>
                        <th width="90">内网IP</th>
                        <th width="90">资产编号</th>
                        <th width="110">内网MAC</th>
                        <th width="120">HOSTNAME</th>
                        <th width="90">外网IP</th>
                        <th width="90">管理卡IP</th>
                        <th width="90">所在机位</th>
                        <th width="80">运行状态</th>
                        <th width="120">所属集群</th>
                        <th width="120">设备型号</th>
                        <th width="80">设备类型</th>
                        <th width="60">制造商</th>
                        <th width="150" nowrap="nowrap">OS类型</th>
                        <th width="60">机型类型</th>
                        <th width="120">最后更新时间</th>
                        <th width="100">操作</th>
                    </tr>
                    </thead>
                </table>
            </div>
            <!-- 服务器资源列表 end -->


            <div class="row">
                <div class="col-xs-12">
                    <form role="form" class="form-horizontal" action="/api/upload/server/serverasset/"
                          enctype="multipart/form-data" method="post">

                        <div class="row">
                            <div class="col-sm-12">
                                <div class="widget-box collapsed">
                                    <div class="widget-header">
                                        <h4 class="widget-title ace-icon fa fa-hand-o-right">批量导入请通过Excel文件上传方式导入</h4>
                                        <div class="widget-toolbar">
                                            <a data-action="collapse" href="#">
                                                <i id="arrow" class="ace-icon fa fa-chevron-up"></i>
                                            </a>

                                            <a data-action="close" href="#">
                                                <i class="ace-icon fa fa-times"></i>
                                            </a>
                                        </div>
                                    </div>

                                    <div class="widget-body">
                                        <div class="widget-main">


                                            <div class="form-group">
                                                <div class="col-xs-12">
                                                    <input multiple="" type="file" id="id-input-file-3" name="title">
                                                </div>
                                            </div>

                                            <label>
                                                <button class="btn btn-app btn-grey btn-xs ">
                                                    <i class="ace-icon fa fa-floppy-o bigger-160"></i>

                                                    保存
                    <span class="badge badge-transparent">

                    </span>
                                                </button>
                                            </label>

                                            <label>
                                                <a class="btn btn-app btn-primary btn-xs" href="#">
                                                    <i class="ace-icon fa fa-pencil-square-o bigger-160"></i>
                                                    模板下载
                                                </a>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>


                    </form>
                </div>
            </div>

        </div><!-- /.page-content -->
    </div><!-- /.main-container -->


    <!-- Modal -->
    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
         id="myModal">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">

                    <!-- 服务详情弹框 start -->
                    <div class="modal-body modal-body-service">
                        <div class="widget-box transparent">
                            <div class="widget-header widget-header-small ui-sortable-handle">
                                <div class="widget-toolbar no-border">
                                    <ul class="nav nav-tabs" id="myTab">
                                        <li class="active">
                                            <a data-toggle="tab" href="#tab1" aria-expanded="true">基本信息</a>
                                        </li>
                                        <li class="">
                                            <a data-toggle="tab" href="#tab2" aria-expanded="false">配件信息</a>
                                        </li>
                                        <li class="">
                                            <a data-toggle="tab" href="#tab3" aria-expanded="false">变更记录</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="widget-body">
                                <div class="widget-main padding-6">
                                    <div class="tab-content">
                                        <div id="tab1" class="tab-pane active">
                                            <table class="table table-bordered ">
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div id="tab2" class="tab-pane">
                                            <table class="table table-bordered ">
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div id="tab3" class="tab-pane">
                                            <table class="table table-bordered ">
                                              <thead>
                                              <tr>
                                                  <th width="30">
                                                    <!--  <label class="pos-rel">
                                                          <input type="checkbox" class="ace">
                                                          <span class="lbl"></span>
                                                      </label> -->
                                                  </th>
                                                  <th width="90" nowrap="nowrap">操作时间</th>
                                                  <th width="90">操作人</th>
                                                  <th width="110">操作内容</th>
                                                  <th width="120">操作对象</th>
                                              </tr>
                                              </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 服务详情弹框 end -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-app btn-success" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal -->
    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel2"
         id="myModal2">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel2">服务器分配</h4>
                </div>
                <div class="modal-body">

                    <div class="row">

                        <div class="col-md-12">
                            <label for="pool">请选择资源池</label>
                            <select class="form-control" id="pool" name="pool">

                            </select>
                        </div>
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-app btn-danger btn-xs" id="add_poll">确认分配</button>
                    <button type="button" class="btn btn-app btn-yellow btn-xs" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- inline scripts related to this page -->
    <script type="text/javascript">
        jQuery(function ($) {
            pool = AddSelectPool();
//console.log(pool);
//initiate dataTables plugin
            var oTable1 =
                    $('#dynamic-table').dataTable({
                        "bLengthChange": false,
                        "bFilter": false,
                        "bSort": false,
                        "bInfo": true,
                        "sScrollX": true,
                        "iDisplayLength": 15,
                      //  "sPaginationType": "full_numbers",
                      //  'bPaginate': true,  //是否分页。

                        "bProcessing": true, // 是否显示取数据时的那个等待提示
                        "bServerSide": true,//这个用来指明是通过服务端来取数据
                        "sAjaxSource": "/api/server/searchserverinfo/",//这个是请求的地址
                        "fnServerData": retrieveData, // 获取数据的处理函数

                        "oLanguage": {
                            "sProcessing": "正在加载中......",
                            "sLengthMenu": "每页显示 _MENU_ 条记录",
                            "sZeroRecords": "对不起，查询不到相关数据！",
                            "sEmptyTable": "表中无数据存在！",
                            "sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",
                            "sInfoFiltered": "数据表中共为 _MAX_ 条记录",
                            "oPaginate": {
                                "sFirst": "首页",
                                "sPrevious": "上一页",
                                "sNext": "下一页",
                                "sLast": "末页",
                            },
                        },
                        "aoColumns": [
                            {
                                "mDataProp": "pk",
                                "sClass": "center",
                                "mRender": function (pk) {
                                    return "<label class='pos-rel'> <input type='checkbox' class='ace' value='" + pk + "'> <span class='lbl'></span> </label>";
                                },
//"sWidth":"5%",
                                "bSortable": false
                            },
                            {
                                "mDataProp": "sn",
                                "mRender": function (fields, type, full) {
                                    return "<a class='tooltip-error'  title='查看详情' onclick='ShowServerList(" + full.pk + ");'>" + fields + "</a>";
                                },
                            },
                            {
                                "mData": "inip",
                                "mRender": function (fields, type, full) {
                                    return "<a class='tooltip-error'  title='查看详情' onclick='ShowServerList(" + full.pk + ");'>" + fields + "</a>";
                                },
                            },
                            {"mData": "num"},
                            {"mData": "mac"},
                            {"mData": "host_name"},
                            {"mData": "outip"},
                            {"mData": "bmcip"},
                            {"mData": "position"},
                            {
                                "mData": "run_status",
                                "sClass": "center",
                                "mRender": function (fields, type, full) {
                                    if (fields != "运行")
                                        return '<span class="label label-sm label-warning">' + fields + '</span>';
                                    else
                                        return '<span class="label label-sm label-success">' + fields + '</span>';
                                },
//"sWidth":"5%",
                            },
                            {"mData": "clusters"},
                            {"mData": "server_type"},
                            {"mData": "device_type"},
                            {"mData": "producer"},
                            {"mData": "os"},
//{ "mData": "cpu" },
//{ "mData": "disk" },
                            {"mData": "inc_type"},
                            {"mData": "las_time"},
                            {
                                "mDataProp": null,
                                "sClass": "center",
                                "mRender": function (fields, type, full) {
                                    if (full.server_operation_status != 0) {
                                        return '<a class="btn btn-app btn-success btn-xs info-btn" title="分配资源池"><i class="ace-icon fa fa-share  info-btn" value="' + full.pk + '"></i></a>';
                                    } else {
                                        return '<a class="btn btn-app btn-grey btn-xs" title="已分配"><i class="ace-icon fa fa-lock"></i></a>';
                                    }
                                },
//"sWidth":"5%",
                                "bSortable": false
                            },
                        ],
                    });

// 3个参数的名字可以随便命名,但必须是3个参数,少一个都不行

            function retrieveData(sSource, aoData, fnCallback) {
                var startnum = aoData[3]['value'];
                var range = aoData[4]['value'];
                var inip = $('#inip').val();
                var outip = $('#outip').val();
                var bmcip = $('#bmcip').val();
                var assetno = $('#accessno').val();
                var assetsn = $('#accesssn').val();
                var cluster = $('#cluster').val();
                var incservertype = $('#incservertype').val();
                var servertype = $('#servertype').val();
                var servermodel = $('#servermodel').val();
                token = GetToken();
                if (token == 'error') {
                    sweetAlert("O NO !", "TOKEN 失效!", "error");
                    return false;
                }
                token = token.data.token;
                datas = {
                    'token': token,
                    'inip': inip,
                    'outip': outip,
                    'bmcip': bmcip,
                    'assetsn': assetsn,
                    'assetno': assetno,
                    'cluster': cluster,
                    'incservertype': incservertype,
                    'servertype': servertype,
                    'servermodel': servermodel,
                    'startnum': startnum,
                    'range': range,
                };
                datas = JSON.stringify(datas);
                $.ajax({
                    url: sSource,//这个就是请求地址对应sAjaxSource
                    data: datas,//这个是把datatable的一些基本数据传给后台,比如起始位置,每页显示的行数
                    type: 'post',
                    dataType: 'json',
                    async: false,
                    success: function (result) {
                        result['iTotalRecords'] = result.data.length;
                        if (result['iTotalRecords'] != 0){
                          result['iTotalDisplayRecords']=result.data[0].data_count;
                        }else{
                          result['iTotalDisplayRecords']=0;
                        }
                        fnCallback(result);//把返回的数据传给这个方法就可以了,datatable会自动绑定数据的
                    },
                    error: function (msg) {
                    }
                });
            }

//TableTools settings
            TableTools.classes.container = "btn-group btn-overlap";
            TableTools.classes.print = {
                "body": "DTTT_Print",
                "info": "tableTools-alert gritter-item-wrapper gritter-info gritter-center white",
                "message": "tableTools-print-navbar"
            }

//initiate TableTools extension
            var tableTools_obj = new $.fn.dataTable.TableTools(oTable1, {
                "sSwfPath": "/static/swf/copy_csv_xls_pdf.swf",

                "sRowSelector": "td:not(:last-child)",
                "sRowSelect": "multi",
    /*            "fnRowSelected": function (row) {
//check checkbox when row is selected
                    try {
                        $(row).find('input[type=checkbox]').get(0).checked = true
                    }
                    catch (e) {
                    }
                },
                "fnRowDeselected": function (row) {
//uncheck checkbox
                    try {
                        $(row).find('input[type=checkbox]').get(0).checked = false
                    }
                    catch (e) {
                    }
                }, */

                "sSelectedClass": "success",
                "aButtons": [
                    {
                        "sExtends": "copy",
                        "sToolTip": "复制到剪贴板",
                        "sButtonClass": "btn btn-white btn-primary btn-bold",
                        "sButtonText": "<i class='fa fa-copy bigger-110 pink'></i>",
                        "fnComplete": function () {
                            this.fnInfo('<h3 class="no-margin-top smaller">列表已拷贝</h3>\
  <p>已拷贝 ' + (oTable1.fnSettings().fnRecordsTotal()) + ' 行到剪贴板.</p>',
                                    1500
                            );
                        }
                    },

                    {
                        "sExtends": "csv",
                        "sToolTip": "倒出为CSV",
                        "sButtonClass": "btn btn-white btn-primary  btn-bold",
                        "sButtonText": "<i class='fa fa-file-excel-o bigger-110 green'></i>"
                    },

                    {
                        "sExtends": "pdf",
                        "sToolTip": "导出为PDF",
                        "sButtonClass": "btn btn-white btn-primary  btn-bold",
                        "sButtonText": "<i class='fa fa-file-pdf-o bigger-110 red'></i>"
                    },

                    {
                        "sExtends": "print",
                        "sToolTip": "打印预览",
                        "sButtonClass": "btn btn-white btn-primary  btn-bold",
                        "sButtonText": "<i class='fa fa-print bigger-110 grey'></i>",

                        "sMessage": "<div class='navbar navbar-default'><div class='navbar-header pull-left'><a class='navbar-brand' href='#'><small>Optional Navbar &amp; Text</small></a></div></div>",

                        "sInfo": "<h3 class='no-margin-top'>Print view</h3>\
    <p>Please use your browser's print function to\
    print this table.\
    <br />Press <b>escape</b> when finished.</p>",
                    }
                ]
            });

//we put a container before our table and append TableTools element to it
            $(tableTools_obj.fnContainer()).appendTo($('.tableTools-container'));

//also add tooltips to table tools buttons
//addding tooltips directly to "A" buttons results in buttons disappearing (weired! don't know why!)
//so we add tooltips to the "DIV" child after it becomes inserted
//flash objects inside table tools buttons are inserted with some delay (100ms) (for some reason)
            setTimeout(function () {
                $(tableTools_obj.fnContainer()).find('a.DTTT_button').each(function () {
                    var div = $(this).find('> div');
                    if (div.length > 0) div.tooltip({container: 'body'});
                    else $(this).tooltip({container: 'body'});
                });
            }, 200);


//ColVis extension
            var colvis = new $.fn.dataTable.ColVis(oTable1, {
                "buttonText": "<i class='fa fa-search'></i>",
                "aiExclude": [0, 6],
                "bShowAll": true,
//"bRestore": true,
                "sAlign": "right",
                "fnLabel": function (i, title, th) {
                    return $(th).text();//remove icons, etc
                }

            });

//style it
            $(colvis.button()).addClass('btn-group').find('button').addClass('btn btn-white btn-info btn-bold')

//and append it to our table tools btn-group, also add tooltip
            $(colvis.button())
                    .prependTo('.tableTools-container .btn-group')
                    .attr('title', '显示/隐藏 列').tooltip({container: 'body'});

//and make the list, buttons and checkboxed Ace-like
            $(colvis.dom.collection)
                    .addClass('dropdown-menu dropdown-light dropdown-caret dropdown-caret-right')
                    .find('li').wrapInner('<a href="javascript:void(0)" />') //'A' tag is required for better styling
                    .find('input[type=checkbox]').addClass('ace').next().addClass('lbl padding-8');


/////////////////////////////////
//table checkboxes
            $('th input[type=checkbox], td input[type=checkbox]').prop('checked', false);

//select/deselect all rows according to table header checkbox
            $('#dynamic-table > thead > tr > th input[type=checkbox]').eq(0).on('click', function () {
                var th_checked = this.checked;//checkbox inside "TH" table header

                $(this).closest('table').find('tbody > tr').each(function () {
                    var row = this;
                    if (th_checked) tableTools_obj.fnSelect(row);
                    else tableTools_obj.fnDeselect(row);
                });
            });

//select/deselect a row when the checkbox is checked/unchecked
            $('#dynamic-table').on('click', 'td input[type=checkbox]', function () {
                var row = $(this).closest('tr').get(0);
                if (!this.checked) tableTools_obj.fnSelect(row);
                else tableTools_obj.fnDeselect($(this).closest('tr').get(0));
            });


            $(document).on('click', '#dynamic-table .dropdown-toggle', function (e) {
                e.stopImmediatePropagation();
                e.stopPropagation();
                e.preventDefault();
            });

            /********************************/
//add tooltip for small view action buttons in dropdown menu
            $('[data-rel="tooltip"]').tooltip({placement: tooltip_placement});

//tooltip placement on right or left
            function tooltip_placement(context, source) {
                var $source = $(source);
                var $parent = $source.closest('table')
                var off1 = $parent.offset();
                var w1 = $parent.width();

                var off2 = $source.offset();
//var w2 = $source.width();

                if (parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2)) return 'right';
                return 'left';
            }

            $("#input-size-slider").css('width', '200px').slider({
                value: 1,
                range: "min",
                min: 1,
                max: 8,
                step: 1,
                slide: function (event, ui) {
                    var sizing = ['', 'input-sm', 'input-lg', 'input-mini', 'input-small', 'input-medium', 'input-large', 'input-xlarge', 'input-xxlarge'];
                    var val = parseInt(ui.value);
                    $('#form-field-4').attr('class', sizing[val]).val('.' + sizing[val]);
                }
            });

            $("#input-span-slider").slider({
                value: 1,
                range: "min",
                min: 1,
                max: 12,
                step: 1,
                slide: function (event, ui) {
                    var val = parseInt(ui.value);
                    $('#form-field-5').attr('class', 'col-xs-' + val).val('.col-xs-' + val);
                }
            });


//"jQuery UI Slider"
//range slider tooltip example
            $("#slider-range").css('height', '200px').slider({
                orientation: "vertical",
                range: true,
                min: 0,
                max: 100,
                values: [17, 67],
                slide: function (event, ui) {
                    var val = ui.values[$(ui.handle).index() - 1] + "";

                    if (!ui.handle.firstChild) {
                        $("<div class='tooltip right in' style='display:none;left:16px;top:-6px;'><div class='tooltip-arrow'></div><div class='tooltip-inner'></div></div>")
                                .prependTo(ui.handle);
                    }
                    $(ui.handle.firstChild).show().children().eq(1).text(val);
                }
            }).find('span.ui-slider-handle').on('blur', function () {
                $(this.firstChild).hide();
            });


            $("#slider-range-max").slider({
                range: "max",
                min: 1,
                max: 10,
                value: 2
            });

            $("#slider-eq > span").css({width: '90%', 'float': 'left', margin: '15px'}).each(function () {
// read initial values from markup and remove that
                var value = parseInt($(this).text(), 10);
                $(this).empty().slider({
                    value: value,
                    range: "min",
                    animate: true

                });
            });

            $("#slider-eq > span.ui-slider-purple").slider('disable');//disable third item

            $('#id-input-file-1 , #id-input-file-2').ace_file_input({
                no_file: 'No File ...',
                btn_choose: 'Choose',
                btn_change: 'Change',
                droppable: false,
                onchange: null,
                thumbnail: false //| true | large
//whitelist:'gif|png|jpg|jpeg'
//blacklist:'exe|php'
//onchange:''
//
            });
//pre-show a file name, for example a previously selected file
//$('#id-input-file-1').ace_file_input('show_file_list', ['myfile.txt'])


            $('#id-input-file-3').ace_file_input({
                style: 'well',
                btn_choose: '点击上传文件',
                btn_change: null,
                no_icon: 'ace-icon fa fa-cloud-upload',
                droppable: true,
                thumbnail: 'small'//large | fit
//,icon_remove:null//set null, to hide remove/reset button
                /**,before_change:function(files, dropped) {
//Check an example below
//or examples/file-upload.html
return true;
}*/
                /**,before_remove : function() {
return true;
}*/
                ,
                preview_error: function (filename, error_code) {
//name of the file that failed
//error_code values
//1 = 'FILE_LOAD_FAILED',
//2 = 'IMAGE_LOAD_FAILED',
//3 = 'THUMBNAIL_FAILED'
//alert(error_code);
                }

            }).on('change', function () {
//console.log($(this).data('ace_input_files'));
//console.log($(this).data('ace_input_method'));
            });


//$('#id-input-file-3')
//.ace_file_input('show_file_list', [
//{type: 'image', name: 'name of image', path: 'http://path/to/image/for/preview'},
//{type: 'file', name: 'hello.txt'}
//]);


//dynamically change allowed formats by changing allowExt && allowMime function
            $('#id-file-format').removeAttr('checked').on('change', function () {
                var whitelist_ext, whitelist_mime;
                var btn_choose
                var no_icon
                if (this.checked) {
                    btn_choose = "Drop images here or click to choose";
                    no_icon = "ace-icon fa fa-picture-o";

                    whitelist_ext = ["jpeg", "jpg", "png", "gif", "bmp"];
                    whitelist_mime = ["image/jpg", "image/jpeg", "image/png", "image/gif", "image/bmp"];
                }
                else {
                    btn_choose = "Drop files here or click to choose";
                    no_icon = "ace-icon fa fa-cloud-upload";

                    whitelist_ext = null;//all extensions are acceptable
                    whitelist_mime = null;//all mimes are acceptable
                }
                var file_input = $('#id-input-file-3');
                file_input
                        .ace_file_input('update_settings',
                                {
                                    'btn_choose': btn_choose,
                                    'no_icon': no_icon,
                                    'allowExt': whitelist_ext,
                                    'allowMime': whitelist_mime
                                })
                file_input.ace_file_input('reset_input');

                file_input
                        .off('file.error.ace')
                        .on('file.error.ace', function (e, info) {
//console.log(info.file_count);//number of selected files
//console.log(info.invalid_count);//number of invalid files
//console.log(info.error_list);//a list of errors in the following format

//info.error_count['ext']
//info.error_count['mime']
//info.error_count['size']

//info.error_list['ext']  = [list of file names with invalid extension]
//info.error_list['mime'] = [list of file names with invalid mimetype]
//info.error_list['size'] = [list of file names with invalid size]


                            /**
                             if( !info.dropped ) {
//perhapse reset file field if files have been selected, and there are invalid files among them
//when files are dropped, only valid files will be added to our file array
e.preventDefault();//it will rest input
}
                             */

                        });
            });

            $('body').on('click', function (event) {
                var $e = $(event.target);
                if ($e.hasClass('info-btn')) {
                    var value = $e.attr('value');
                    $('#myModal2').modal('show');
                    $('#add_poll').on('click', function (event) {
                        var select = $('#pool').val();
                        var token = GetToken();
                        if (token == 'error') {
                            sweetAlert("O NO !", "TOKEN 失效!", "error");
                            return false;
                        }
                        token = token.data.token;
                        var postData = {'token': token, 'pk': value, 'pool_name': select};
                        postData = JSON.stringify(postData);

                        $.ajax({
                            url: '/api/server/addservertopool/',
                            type: 'POST',
                            data: postData,
                            dataType: 'json',
                            success: function (data) {
                                var data = data.code;
                                if (data == "0") {
                                    swal({
                                        title: '分配成功',
                                        type: "success",
                                        showCancelButton: false,
                                        cancelButtonText: 'cancel',
                                        confirmButtonClass: "btn-success",
                                        closeOnConfirm: true
                                    }, function () {
                                        $('#myModal2').modal('hide');
                                        ServerSearch();
                                        return false
                                    });
                                } else if (data != "0") {
                                    swal({
                                        title: " 服务器分配失败",
                                        type: "warning",
                                        showCancelButton: false,
                                        cancelButtonText: 'cancel',
                                        confirmButtonClass: "btn-success",
                                        closeOnConfirm: false
                                    });
                                }
                            }
                        });
                    });
                }
            });


        })
    </script>
{% endblock %}
