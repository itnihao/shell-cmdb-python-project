{%extends base%}
{% block extra_head %}

<link rel="stylesheet" href="{{STATIC_URL}}css/jquery-ui.min.css" />
<link rel="stylesheet" href="{{STATIC_URL}}css/dropzone.min.css" />
<link rel="stylesheet" href="{{STATIC_URL}}css/chosen.min.css" />
<link rel="stylesheet" href="{{STATIC_URL}}css/jquery-ui.custom.min.css" />
<link rel="stylesheet" href="{{STATIC_URL}}css/proj/common.css" />
<link rel="stylesheet" href="{{STATIC_URL}}plugin/sweetalert/sweet-alert.css" />
<link rel="stylesheet" href="{{STATIC_URL}}plugin/select2/select2.css"/>

<script type="text/javascript" src="{{STATIC_URL}}plugin/select2/select2.min.js">  </script>
<script src="{{STATIC_URL}}js/dropzone.min.js"></script>
<script src="{{STATIC_URL}}js/bootbox.min.js"></script>
<script src="{{STATIC_URL}}js/fuelux.tree.min.js"></script>
<script src="{{STATIC_URL}}js/jquery.dataTables.min.js"></script>
<script src="{{STATIC_URL}}js/jquery.dataTables.bootstrap.min.js"></script>
<script src="{{STATIC_URL}}js/dataTables.tableTools.min.js"></script>
<script src="{{STATIC_URL}}js/dataTables.colVis.min.js"></script>
<script src="{{STATIC_URL}}plugin/sweetalert/sweet-alert.min.js"></script>
<script src="{{STATIC_URL}}js/tables.js"></script>




<!-- page specific plugin scripts -->
{% endblock %}
{% block Hometitle %}基础资源管理{% endblock %}
{% block actiontitle %} <a href="{% url 'baseresource.index' %}"> 资源管理 </a>{% endblock %}
{% block pagetitle %}资源管理{% endblock %}
{% block pagecontent %}


<!-- Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal0">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel0">增加集群信息</h4>
      </div>
      <div class="modal-body">
        <div class="row" id="div0">
          <div class="col-md-3">
            <label for="TIncServerType_name">名称</label>
            <input type="text" class="form-control" id="TIncServerType_name" placeholder="名称"></input>
          </div>
          <div class="col-md-6">
            <label for="TIncServerType_desc">详情</label>
            <input type="text" class="form-control" id="TIncServerType_desc" placeholder="详情"></input>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" id="saveChange0">保存</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal1">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel1">增加集群信息</h4>
      </div>
      <div class="modal-body">
        <div class="row" id="div1">
          <div class="col-md-3">
            <label for="TServerDeviceType_name">名称</label>
            <input type="text" class="form-control" id="TServerDeviceType_name" placeholder="名称"></input>
          </div>
          <div class="col-md-3">
            <label for="TServerDeviceType_height">Height</label>
            <input type="text" class="form-control" id="TServerDeviceType_height" placeholder="Height"></input>
          </div>
          <div class="col-md-3">
            <label for="TServerDeviceType_Product">厂商</label>
            <input type="text"  style="width:100%;" id="TServerDeviceType_Product" value="厂商"></input>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" id="saveChange1">保存</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal2">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel2">增加集群信息</h4>
      </div>
      <div class="modal-body">
        <div class="row" id="div2">
          <div class="col-md-3">
            <label for="TDeviceProducerType_name">名称</label>
            <input type="text" class="form-control" id="TDeviceProducerType_name" placeholder="名称"></input>
          </div>
          <div class="col-md-3">
            <label for="TDeviceProducerType_type">类型</label>
            <input type="text" class="form-control" id="TDeviceProducerType_type" placeholder="类型"></input>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" id="saveChange2">保存</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal3">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel3">增加集群信息</h4>
      </div>
      <div class="modal-body">
        <div class="row" id="div3">
          <div class="col-md-3">
            <label for="TOsType_name">名称</label>
            <input type="text" class="form-control" id="TOsType_name" placeholder="名称"></input>
          </div>
          <div class="col-md-3">
            <label for="TOsType_type">type_version</label>
            <input type="text" class="form-control" id="TOsType_type" placeholder="type_version"></input>
          </div>
          <div class="col-md-3">
            <label for="TOsType_kernerl">kernerl_version</label>
            <input type="text" class="form-control" id="TOsType_kernerl" placeholder="kernerl_version"></input>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" id="saveChange3">保存</button>
      </div>
    </div>
  </div>
</div>


<!--模拟框结束-->

<div class="main-container" id="main-container">
  <div class="page-content">
    <div class="widget-box collapsed">
      <div class="row">
        <div class="col-xs-3">
          <input id="select" style="width:90%;" onchange="baseResourceChanged()" value="选择数据表">
          </input>
        </div>
      </div>

      <hr>

      <div class="row">
        <div class="col-xs-12">
        <!--
          <div class="clearfix">
            <div class="pull-right tableTools-container"></div>
          </div>
        -->
          <div class="table-header" id="buslineListHeader">
            基础资源
          </div>
          <div>
            <table id="dynamic-table" class="table table-striped table-bordered table-hover">
              <thead id="theadTap">
                <tr class="trTap">
                  <!-- {% if baseresourcetype %}
                  <th style="text-align:center;">编号</th>
                  <th style="text-align:center;">类型</th>
                  <th style="text-align:center;">其他</th>
                  <th style="text-align:center;">操作</th>
                  {% endif %} -->
                </tr>
              </thead>
            </table>
            <div class="table-footer">
              <button id="addBtn">添加</button>
            </div>
          </div>
        </div>
        <div class="space-12"></div>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">

var baseresourcetype = {{resourceID}};
//被选择操作的数据
var selectData;
var columns = [];
var currentData = [];
//厂商选择列表的数据
var products;
jQuery(function($) {

  //重置table的标签
  resetDataTable();
  var data = GetBaseResourceData(baseresourcetype).data;
  for (var i = 0; i < data.length; i++) {
    obj = data[i];
    currentData.push(obj);
  }
  // console.log(data);
  var oTable1 =
  $('#dynamic-table')
  .dataTable( {
    bStateSave: true,
    sScrollX: "100%",
    bAutoWidth: true,
    "aoColumns": columns,
    "aaSorting": [],
    "aaData": data,
    } );

  var dataList = [{'text': '服务器选型', 'id': '0'}, {'text': '服务器型号', 'id': '1'}, {'text': '设备厂商', 'id':'2'}, {'text': '操作系统', 'id':'3'}];
  $("#select").select2({
    data:dataList,
    initSelection: function(element, callback){
      var num = 0;
      if (parseInt(baseresourcetype) != 0) {
        num = parseInt(baseresourcetype);
      }
      dic = dataList[num];
      console.log(dic);
      callback(dic);
    }
  });

  products = GetProducerData().data;
});

function resetDataTable(){
  // # server_device_tincservertype          0       TIncServerType
  // # server_device_tserverdevicetype       1       TServerDeviceType
  // # server_device_tdeviceproducertype     2       TDeviceProducerType
  // # server_device_tostype                 3       TOsType
  $('tr.trTap').children('th').remove();
  var taps;
  if (parseInt(baseresourcetype) == 0) {
    taps = '<th style="text-align:center;">名称</th>\
                <th style="text-align:center;">详情</th>\
                <th style="text-align:center;">操作</th>';
    columns = [
      { "mData": "code"},
      { "mData": "name"},
      { "mDataProp": null,
          "sClass": "center",
          "mRender": function(fields,type,full){
          return "<a class='tooltip-error' onclick='modelShow(" + full.id + ")'>编辑</a>"
        },
          "bSortable":false
      },
    ];
  }else if (parseInt(baseresourcetype) == 1) {
    taps = '<th style="text-align:center;">名称</th>\
                <th style="text-align:center;">Height</th>\
                <th style="text-align:center;">厂商</th>\
                <th style="text-align:center;">操作</th>';
    columns = [
                  { "mData": "code"},
                  { "mData": "name"},
                  { "mData": "other"},
                  { "mDataProp": null,
                      "sClass": "center",
                      "mRender": function(fields,type,full){
                      return "<a class='tooltip-error' onclick='modelShow(" + full.id + ")'>编辑</a>"
                    },
                      "bSortable":false
                  },
                ];
  }else if (parseInt(baseresourcetype) == 2) {
    taps = '<th style="text-align:center;">名称</th>\
                <th style="text-align:center;">类型</th>\
                <th style="text-align:center;">操作</th>';
    columns = [
                  { "mData": "code"},
                  { "mData": "name"},
                  { "mDataProp": null,
                      "sClass": "center",
                      "mRender": function(fields,type,full){
                      return "<a class='tooltip-error' onclick='modelShow(" + full.id + ")'>编辑</a>"
                    },
                      "bSortable":false
                  },
                ];
  }else if (parseInt(baseresourcetype) == 3) {
    taps = '<th style="text-align:center;">名称</th>\
                <th style="text-align:center;">type_version</th>\
                <th style="text-align:center;">kernerl_version</th>\
                <th style="text-align:center;">操作</th>';
    columns = [
                  { "mData": "code"},
                  { "mData": "name"},
                  { "mData": "other"},
                  { "mDataProp": null,
                      "sClass": "center",
                      "mRender": function(fields,type,full){
                      return "<a class='tooltip-error' onclick='modelShow(" + full.id + ")'>编辑</a>"
                    },
                      "bSortable":false
                  },
                ];
  }
  $('tr.trTap').append(taps)
}

function baseResourceChanged(){
  var selectID = $('#select').select2('data').id;
  var url ='/baseresource/?id=' + selectID;
  resourceID = selectID;
  location.replace(url)
}

function modelShow(id){
  for (var i = 0; i < currentData.length; i++) {
    var obj = currentData[i];
    if (obj.id == id) {
      selectData = obj;
      break;
    }
  }

  $('#TServerDeviceType_Product').select2({
    data:products,
    initSelection: function (element, callback){
                    var name;
                    var id;
                    // console.log(selectData);
                    var target = selectData.other;
                    // console.log(target);
                    for (var i = 0; i < products.length; i++) {
                       dic = products[i];
                       if (dic.text == target) {
                         name = dic.text;
                         id = dic.id;
                         break;
                       }
                    }
                    data = {'text':name,'id':id};
                    // console.log(data);
                    callback(data);
            }
          });

  if (parseInt(baseresourcetype) == 0) {
    $('#myModal0').modal('show');
    $('#TIncServerType_name').val(selectData.code);
    $('#TIncServerType_desc').val(selectData.name);
  }else if (parseInt(baseresourcetype) == 1) {
    $('#myModal1').modal('show');
    $('#TServerDeviceType_name').val(selectData.code);
    $('#TServerDeviceType_height').val(selectData.name);
    // $('#TServerDeviceType_Product').val(selectData.other);
  }else if (parseInt(baseresourcetype) == 2) {
    $('#myModal2').modal('show');
    $('#TDeviceProducerType_name').val(selectData.code);
    $('#TDeviceProducerType_type').val(selectData.name);
  }else if (parseInt(baseresourcetype) == 3) {
    $('#myModal3').modal('show');
    $('#TOsType_name').val(selectData.code);
    $('#TOsType_type').val(selectData.name);
    $('#TOsType_kernerl').val(selectData.other);
  }
}

$('#addBtn').on('click', function(){

  if (parseInt(baseresourcetype) == 0) {
    $('#myModal0').modal('show');
    $('#TIncServerType_name').val('');
    $('#TIncServerType_desc').val('');
  }else if (parseInt(baseresourcetype) == 1) {
    $('#myModal1').modal('show');
    $('#TServerDeviceType_name').val('');
    $('#TServerDeviceType_height').val('');
    // $('#TServerDeviceType_Product').val('');
  }else if (parseInt(baseresourcetype) == 2) {
    $('#myModal2').modal('show');
    $('#TDeviceProducerType_name').val('');
    $('#TDeviceProducerType_type').val('');
  }else if (parseInt(baseresourcetype) == 3) {
    $('#myModal3').modal('show');
    $('#TOsType_name').val('');
    $('#TOsType_type').val('');
    $('#TOsType_kernerl').val('');
  }

});

$('#saveChange0').on('click', function(){

  SaveBaseResourceChanges();

});

$('#saveChange1').on('click', function(){

  SaveBaseResourceChanges();

});

$('#saveChange2').on('click', function(){

  SaveBaseResourceChanges();

});

$('#saveChange3').on('click', function(){

  SaveBaseResourceChanges();

});

function SaveBaseResourceChanges(){

  var id;
  if (selectData) {
    id = selectData.id;
  }else {
    id = '';
  }

  var code ;
  var name ;
  var other ;

  if (parseInt(baseresourcetype) == 0) {
    code = $('#TIncServerType_name').val();
    name = $('#TIncServerType_desc').val();
  }else if (parseInt(baseresourcetype) == 1) {
    code = $('#TServerDeviceType_name').val();
    name = $('#TServerDeviceType_height').val();
    // other = $('#TServerDeviceType_Product').val();
    other = $('#TServerDeviceType_Product').select2('data').id;
    console.log(other);
    if (!other) {
      alert('请选择厂商');
      return;
    }
  }else if (parseInt(baseresourcetype) == 2) {
    code = $('#TDeviceProducerType_name').val();
    name = $('#TDeviceProducerType_type').val();
  }else if (parseInt(baseresourcetype) == 3) {
    code = $('#TOsType_name').val();
    name = $('#TOsType_type').val();
    other = $('#TOsType_kernerl').val();
  }

  // SaveBaseResourceChange(baseresourcetype, id, code, name, other);

  selectData = null;

}

</script>


{% endblock %}
